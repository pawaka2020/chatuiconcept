Login page: 
- Sign in or Sign up
- When user clicks Sign in, go to signin page. 
- For production stage, assume we already have a registered User, Alpha. 
- When we click Sign in, change status of Alpha in User table to 'online',
- when app closes, change status of Alpha to 'offline'

Let's KISS and stop using enums.
Worry about the code behind models for later. 

CREATE TABLE users (
id SERIAL PRIMARY KEY,
name TEXT NOT NULL,
status TEXT,
image_url TEXT,
signature TEXT,
last_seen TIMESTAMP WITHOUT TIME ZONE NOT NULL,
password_hash TEXT NOT NULL
);

class User {
int id;
String name;
String status;
String imageUrl;
String signature;
DateTime lastSeen;
String passwordHash;

User({
this.id,
required this.name,
this.status,
this.imageUrl,
this.signature,
required this.lastSeen,
required this.passwordHash,
});

}

After sign in, store something in the app like User id then do a query of all LastMessage that has a matching
SentTo id.

LastMessage(
int senderId;
String senderName;
String senderImageUrl;
String lastMessageSnippet;
DateTime timeSent;
int recipientId;
);

CREATE TABLE last_messages (
id SERIAL PRIMARY KEY,
sender_id INTEGER NOT NULL REFERENCES users(id),
recipient_id INTEGER NOT NULL REFERENCES users(id),
sender_name TEXT NOT NULL,
sender_image_url TEXT,
last_message_snippet TEXT,
time_sent TIMESTAMP WITHOUT TIME ZONE NOT NULL
);

==============================================================
Alternative idea, use Room instead of LastMessage.
Roombeta(
enum {PM, Group} type;
List<Id> members;
String roomName, default value '', only fill if type = Group.
);

Class Room
{
    int roomId; //id of room to be referenced by ChatMessage
    String type; //can be either 'pm' or 'group'
    String name; //default value '', only fill if type == 'group'
    List<int> memberId; //list of all the id of Users in the room.
    String imageurl; //image url of room if type == 'group', default value ''
    DateTime lastPostingTime;
    ChatMessage lastMessage;
}

In ChatList room, show all cards with Room with matching id inside memberid.
if group, show imageurl, name, lastMessage, lastposting.
if pm, show imageurl of user opposite currentuser, opposite user as the 'name', lastmessage, lastposttime

import 'package:encrypt/encrypt.dart';

class ChatMessage {
final String messageId;
final String senderId;
final String recipientId;
final String messageText;
final List<String> emojiList;
final List<String> fileList;
final DateTime timestamp;
final int roomId;

ChatMessage({
required this.messageId,
required this.senderId,
required this.recipientId,
required this.messageText,
required this.emojiList,
required this.fileList,
required this.timestamp,
});

// Encrypt the message text using a given encryption key
String encryptMessage(String encryptionKey) {
final key = Key.fromUtf8(encryptionKey);
final iv = IV.fromLength(16);
final encrypter = Encrypter(AES(key));
final encrypted = encrypter.encrypt(messageText, iv: iv);
return encrypted.base64;
}

// Decrypt an encrypted message using a given encryption key
String decryptMessage(String encryptionKey, String encryptedText) {
final key = Key.fromUtf8(encryptionKey);
final iv = IV.fromLength(16);
final encrypter = Encrypter(AES(key));
final encrypted = Encrypted.fromBase64(encryptedText);
final decrypted = encrypter.decrypt(encrypted, iv: iv);
return decrypted;
}
}

======================================================

user logs in:
In RoomsScreen, loads all rooms that have the same id as user inside the list membersId;
clicking at a card, loads all messages that have the same room id. 
So now we have three classes: User, Message and Room:

======================================================
//password must be encrypted early. 

class ChatUser {
//id auto-generated by Supabase
int id;
//name of user
String name;
//status whether 'online', 'active' or 'offline'
String status;
//data for one image, stored in Storage of Supabase, but I want it to be default null
List<int>? imageData; 
//Signature of a user, only in string form without emojis or images.
String signature;
//Last time a user is 'online'. Automatically generated by Supabase when user is created or when existing user
//logs off.
DateTime lastSeen;
//password encrypted.
String passwordHash;

ChatUser({
this.id,
required this.name,
this.status = 'offline',
this.imageData,
this.signature = '',
required this.lastSeen,
required this.passwordHash,
});
}

CREATE TABLE users (
id SERIAL PRIMARY KEY,
name TEXT NOT NULL,
status TEXT DEFAULT 'offline',
imageData BYTEA,
signature TEXT NOT NULL DEFAULT '',
lastSeen TIMESTAMP NOT NULL DEFAULT now(),
passwordHash TEXT NOT NULL
);

-- Example INSERT statement
INSERT INTO users (name, last_seen, password_hash)
VALUES ('John Doe', '2022-02-20 13:00:00', crypt('secret_password', gen_salt('bf')));

option in chat to show deleted message record.
========================================================
///whole message must be encrypted
class ChatMessage {
// id of message, automatically generated by postgres
final int id;
// id of sender, references to id in User class.
final int senderId;
// text of message.
final String messageText;
// list of all the emojis included in the message, can be null
final List<String>? emojiList;
// list of all the files included in the message, can be null
final List<String>? fileList;
// auto-generated by Supabase when a new entry is added to the table.
final DateTime timestamp;
// whether or not message has been deleted, default false.
final bool deleted;

ChatMessage({
this.id,
required this.senderId,
this.messageText = '',
this.emojiList,
this.fileList,
this.timestamp,
this.deleted = false,
});

// Reference to the User table where sender's details can be fetched
// Supabase automatically creates the table name from the class name in plural form.
static final table = 'users';

// A function to fetch the image data of the sender from the User table
Future<List<int>?> getSenderImageData() async {
final response =
await supabase.from(table).select('image_data').eq('id', senderId).execute();
if (response.error != null) {
// Handle error
return null;
}
// Return the imageData of the sender, or null if the sender doesn't exist.
return response.data?[0]['image_data'];
}
}


CREATE TABLE messages (
id SERIAL PRIMARY KEY,
user_id INTEGER NOT NULL,
image_url TEXT,
message_text TEXT NOT NULL,
emoji_list TEXT[],
file_list TEXT[],
timestamp TIMESTAMP DEFAULT NOW()
);
=====================================================--

class ChatRoom {
//id of room, automatically generated by Supabase.
int id;
//type of room, can be either 'pm' or 'group'
String type;
//name of room, default value '', only fill if type == 'group'
String name;
//data for room image, stored in Storage of Supabase, but I want it to be default null, only fill if type == 'group'
List<int>? imageData;
//list of all the id of Users in the room, references to id in User.
List<int> memberIds;
//id of the last message, references to id in Message.
int lastMessageId;
//date the room is created, generated automatically by Supabase when a new room is written to the table.
DateTime dateCreated;

ChatRoom({
this.id,
required this.type,
this.name = '',
this.imageData,
required this.memberIds,
required this.lastMessageId,
required this.dateCreated,
});
}
Make sure to create the corresponding fields in the Supabase table when you create the Room table.

actually another type of room is better
-----------------------------------------------------------------
class ChatRoom{
//id of room, automatically generated by Supabase.
Final int id;
//type of room, can be either 'pm' or 'group'
String type;
//name of room, default value '', only fill if type == 'group'
String name;
//data for room image, stored in Storage of Supabase, but I want it to be default null, only fill if type == 'group'
List<int>? imageData;
//list of all the id of Users in the room, references to id in User.
List<int> memberIds;
//id of owner, but left null, only filled if type == 'group'
int? ownerId;
//id of the last message, references to id in Message, but can be left null for new room
int? lastMessageId;
//time last active, automatically generatedby Supabase, entered when room newly created or when new message is posted.
final DateTime? lastActive;
}




    