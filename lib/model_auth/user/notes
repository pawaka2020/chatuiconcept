CREATE TABLE chat_users_auth (
uid uuid PRIMARY KEY,
username TEXT,
signature TEXT,
avatar_url TEXT,
date_created TIMESTAMPTZ,
contacts TEXT[] DEFAULT '{}'
);
CREATE INDEX name_idx_cua ON chat_users_auth (name);

CREATE OR REPLACE FUNCTION insert_users_auth_batch(users chat_users_auth[])
  RETURNS void AS
$BODY$
BEGIN
  -- Insert users
  IF ARRAY_LENGTH(users, 1) > 0 THEN
    INSERT INTO chat_users_auth
    SELECT * FROM UNNEST(users);
  END IF;
END;
$BODY$
  LANGUAGE plpgsql VOLATILE;

SELECT cron.schedule('insert_users_batch_auth_job', '*/5 * * * * *', 'SELECT * FROM insert_users_auth_batch(ARRAY[]::chat_users_auth[])');